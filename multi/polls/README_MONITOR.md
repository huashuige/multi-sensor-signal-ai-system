# 信号监控模块功能说明

## 概述
信号监控模块是基于WebSocket的实时信号采集与监控系统，支持定时采集、数据可视化、状态监控等功能。

## 主要功能

### 1. 设备连接管理
- **设备连接**: 通过WebSocket连接USB5121数据采集卡
- **设备状态**: 实时显示设备连接状态
- **设备断开**: 安全断开设备连接

### 2. 通道配置
- **16通道支持**: 支持CH0-CH15共16个AI通道
- **量程设置**: 每个通道可独立设置电压量程 (±1V, ±2V, ±5V, ±10V)
- **灵敏度配置**: 支持自定义灵敏度设置 (A/V)
- **通道启用/禁用**: 可选择启用或禁用特定通道

### 3. 监控配置
- **采集间隔**: 设置定时采集的时间间隔 (1-3600秒)
- **采集点数**: 每次采集的数据点数 (100-10000点)
- **总监控时长**: 设置监控的总时长 (1-1440分钟)
- **采样率**: 设置数据采集的采样率 (100Hz-1MHz)

### 4. 监控控制
- **开始监控**: 启动定时采集监控
- **停止监控**: 停止监控并清理资源
- **暂停/继续**: 暂停或继续监控过程
- **实时状态**: 显示当前采集次数、剩余时间等

### 5. 数据可视化
- **实时图表**: 使用ECharts显示实时信号波形
- **多通道显示**: 同时显示多个通道的数据
- **时间轴**: 自动生成时间轴显示
- **数据统计**: 显示每个通道的统计信息

### 6. 数据管理
- **数据保存**: 保存监控配置和采集数据
- **数据清空**: 清空当前显示的数据
- **进度显示**: 显示监控进度条

## 技术架构

### 前端 (monitor.html)
- **WebSocket通信**: 与后端实时通信
- **ECharts图表**: 数据可视化
- **响应式设计**: 适配不同屏幕尺寸
- **状态管理**: 实时更新界面状态

### 后端 (consumers_monitor.py)
- **WebSocket消费者**: 处理WebSocket连接和消息
- **设备驱动**: 集成USB5121驱动
- **数据采集**: 定时采集信号数据
- **数据处理**: 处理和分析采集数据

### 设备驱动 (dap_driver.py)
- **USB5121驱动**: 底层设备通信
- **多通道支持**: 支持16个AI通道
- **采集控制**: 连续和单次采集模式
- **数据回调**: 异步数据回调机制

## 使用流程

1. **连接设备**: 点击"连接"按钮连接数据采集卡
2. **配置通道**: 打开通道配置弹窗，设置需要监控的通道
3. **设置参数**: 配置采样率、采集点数等参数
4. **时间配置**: 设置采集间隔和总监控时长
5. **开始监控**: 点击"开始监控"启动定时采集
6. **查看数据**: 实时查看采集的信号波形
7. **保存数据**: 保存监控配置和采集数据
8. **停止监控**: 完成监控后停止采集

## 消息协议

### 客户端到服务器
- `open_device`: 打开设备
- `close_device`: 关闭设备
- `configure_channels`: 配置通道
- `configure_monitor`: 配置监控参数
- `start_monitoring`: 开始监控
- `stop_monitoring`: 停止监控
- `pause_monitoring`: 暂停/继续监控

### 服务器到客户端
- `success`: 操作成功消息
- `error`: 错误消息
- `monitor_data`: 监控数据
- `configure_channels_result`: 通道配置结果
- `monitor_status`: 监控状态更新

## 注意事项

1. **设备连接**: 确保USB5121设备已正确连接并安装驱动
2. **通道配置**: 至少需要启用一个通道才能开始监控
3. **参数设置**: 采样率和采集点数需要根据实际需求合理设置
4. **数据存储**: 监控数据会临时存储在内存中，建议定期保存
5. **网络连接**: 确保WebSocket连接稳定，避免数据丢失

## 故障排除

1. **设备连接失败**: 检查设备驱动和USB连接
2. **数据采集异常**: 检查通道配置和采样参数
3. **图表显示问题**: 刷新页面或重新连接WebSocket
4. **监控停止**: 检查监控时间设置和网络连接 